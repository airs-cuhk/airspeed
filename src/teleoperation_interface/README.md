# Teleoperation Interface - VRé¥æ“ä½œæ¥å£
# VRæœºå™¨äººé¥æ“ä½œå¹³å° - é¥æ“ä½œæ¥å£éƒ¨åˆ†

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯åŸºäºROS2æ¡†æ¶çš„VRï¼ˆè™šæ‹Ÿç°å®ï¼‰æœºå™¨äººé¥æ“ä½œå¹³å°çš„**é¥æ“ä½œæ¥å£éƒ¨åˆ†**ã€‚è¯¥æ¥å£è´Ÿè´£æ¥æ”¶VRè®¾å¤‡æ•°æ®ï¼Œè¿›è¡Œå¤„ç†å’Œè½¬æ¢ï¼Œç„¶åé€šè¿‡ROS2è¯é¢˜å®æ—¶å‘å¸ƒç»™æœºå™¨äººæ¥å£ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- âœ… ROS2åŸç”Ÿè¯é¢˜é€šä¿¡ï¼ˆæ— æ–‡ä»¶ä¾èµ–ï¼‰
- âœ… å®æ—¶æ•°æ®æµå¤„ç†ï¼ˆä½å»¶è¿Ÿ<5msï¼‰
- âœ… ç¨³å®š10Hzè¾“å‡ºé¢‘ç‡
- âœ… æ¨¡å—åŒ–æ¶æ„è®¾è®¡
- âœ… çº¿ç¨‹å®‰å…¨çš„æ•°æ®å¤„ç†
1
**æŒ‰é”®ä»‹ç»**:
B :æœºå™¨äººåˆå§‹ä½å§¿é”®
A :æœºå™¨äººä¸äººæ ‡å®šæŒ‰é”®
Grip Button :åŠ¨ä½œåŒæ­¥å¯åŠ¨é”®
Grip Button + Trigger Button :å¤¹çˆªå¼€åˆé”®

Grip Button + å·¦æ‘‡æ† :åº•ç›˜ç§»åŠ¨
Grip Button + å³æ‘‡æ† :èº¯å¹²ä¸Šä¸‹è¿åŠ¨
Y:å¼€å§‹/ç»“æŸå½•åˆ¶æ•°æ®

x:ç¡®è®¤ä¿å­˜æ•°æ®

**æ“ä½œæµç¨‹**:
1. æ‹¿èµ·æ‰‹æŸ„ï¼Œä¿æŒã€å›¾ç¤ºã€‘çŠ¶æ€:
æŒ‰ä¸‹ B é”®ï¼Œæœºå™¨äººå›åˆ°åˆå§‹ä½å§¿
æŒ‰ä¸‹ A é”®ï¼Œè¿›è¡Œäººæœºæ ‡èµ°ã€‚
2. åŠ¨ä½œåŒæ­¥æ“ä½œ:
æŒ‰ä½ Grip Buttonï¼Œæ™ƒåŠ¨æ‰‹æŸ„ï¼Œæœºå™¨äººå°†è·Ÿéšæ‰‹æŸ„è¿åŠ¨
3. å¤¹çˆªæ§åˆ¶:
æŒ‰ä¸‹Trigger Buttonï¼Œæ§åˆ¶æœºå™¨äººçš„å¤¹çˆªå¼€å°ã€
4. åº•ç›˜&torsoæ§åˆ¶:
æŒ‰ä½ Grip ButtonåŒæ—¶æ‹¨åŠ¨æ‘‡æ†æ§åˆ¶åº•ç›˜è¿åŠ¨ã€‚
Â·å³æ‰‹æŸ„æ‘‡æ†:æ§åˆ¶æœºå™¨äººèº¯å¹²ä¸Šä¸‹è¿åŠ¨ã€‚
Â·å·¦æ‰‹æŸ„æ‘‡æ†:æ§åˆ¶åº•ç›˜ç§»åŠ¨
5. æ•°æ®é‡‡é›†ä»»åŠ¡:
æŒ‰ä¸‹ Y é”®ï¼Œå¼€å§‹å½•åˆ¶æ•°æ®ã€‚æ­¤æ—¶å¯ä»¥è¿›è¡Œæ•°æ®é‡‡é›†æ“ä½œã€‚
å†æ¬¡æŒ‰ä¸‹ Y é”®ï¼Œç»“æŸå½•åˆ¶æ•°æ®ã€‚æ•°æ®å°†é¢„å­˜ã€‚
6. æ•°æ®ä¿å­˜:
æŒ‰ä¸‹ X é”®ï¼Œç¡®è®¤ä¿å­˜æ•°æ®è‡³ Orin å¯¹åº”çš„ä»»åŠ¡æ–‡ä»¶å¤¹ä¸­ã€‚
å¦‚æœå¯¹åˆšé‡‡é›†çš„æ•°æ®ä¸æ»¡æ„ï¼Œå¯ç›´æ¥æŒ‰ä¸‹ Y é”®è¿›è¡Œä¸‹ä¸€è½®æ•°æ®é‡‡é›†å½•åˆ¶ã€‚
</center> 
<img src="vr.jpg" width="50%">
</center>

**æ³¨æ„äº‹é¡¹**:

å¦‚æœåœ¨é‡‡é›†è¿‡ç¨‹ä¸­äººç§»åŠ¨äº†ä½ç½®ï¼Œè¯·é‡æ–°æŒ‰ä¸‹ A é”®è¿›è¡Œäººæœºæ ‡å®šï¼Œä»¥é¿å…åŠ¨ä½œä¸åŒæ­¥æˆ–å¼‚å¸¸é—®é¢˜ä¸ºç¡®ä¿æ•°æ®é‡‡é›†è´¨é‡ï¼Œå¦‚æœåœ¨é‡‡é›†è¿‡ç¨‹ä¸­å‡ºç°é©±åŠ¨å¼‚å¸¸ï¼Œè¯·å…ˆä¿®å¤é©±åŠ¨é—®é¢˜ï¼Œå¦åˆ™æ•°æ®å¯èƒ½ä¼šå—å½±å“ã€‚
---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
VRè®¾å¤‡ (Quest/Pico)
    â”‚
    â”‚ HTTPS POST (JSON, ~60-90Hz)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VR Data Server (vr_data_server.py)        â”‚
â”‚  â”œâ”€ HTTPS Server (aiohttp, 5000ç«¯å£)       â”‚
â”‚  â””â”€ VRDataPublisherNode (ROS2èŠ‚ç‚¹)         â”‚
â”‚      â””â”€ å‘å¸ƒ: /vr_raw_data (String)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ ROS2 Topic: /vr_raw_data (std_msgs/String)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VR Teleoperation Node                      â”‚
â”‚  (vr_teleoperation_node.py)                â”‚
â”‚  â”œâ”€ è®¢é˜…: /vr_raw_data                     â”‚
â”‚  â”œâ”€ æ•°æ®æå–ä¸è½¬æ¢                          â”‚
â”‚  â”œâ”€ åæ ‡ç³»è½¬æ¢ (VR â†’ æ ‡å‡†)                  â”‚
â”‚  â””â”€ å®šæ—¶å™¨å‘å¸ƒ (10Hzç¨³å®šè¾“å‡º)              â”‚
â”‚      â”œâ”€ /target_head_pose                  â”‚
â”‚      â”œâ”€ /target_left_arm_pose              â”‚
â”‚      â”œâ”€ /target_left_buttons               â”‚
â”‚      â”œâ”€ /target_right_arm_pose             â”‚
â”‚      â””â”€ /target_right_buttons              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ ROS2 Topics (PoseStamped, Float32MultiArray)
    â†“
æœºå™¨äººæ¥å£ (Robot Interface)
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
teleoperation_interface/
â”œâ”€â”€ vr_teleoperation/              # æ ¸å¿ƒèŠ‚ç‚¹æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ vr_data_server.py          # VRæ•°æ®æ¥æ”¶æœåŠ¡å™¨ + ROS2å‘å¸ƒå™¨
â”‚   â””â”€â”€ vr_teleoperation_node.py   # VRæ•°æ®å¤„ç†ä¸è½¬æ¢èŠ‚ç‚¹
â”œâ”€â”€ launch/                        # ROS2å¯åŠ¨æ–‡ä»¶
â”‚   â””â”€â”€ vr_teleoperation.launch.py # ç»Ÿä¸€å¯åŠ¨æ–‡ä»¶
â”œâ”€â”€ config/                        # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.json                # æœåŠ¡å™¨é…ç½®ï¼ˆIPã€ç«¯å£ï¼‰
â”‚   â””â”€â”€ teleoperation_config.yaml  # èŠ‚ç‚¹é…ç½®ï¼ˆå­—æ®µã€è½¬æ¢ã€è¯é¢˜ï¼‰
â”œâ”€â”€ else/                          # å…¶ä»–æ–‡ä»¶
â”‚   â”œâ”€â”€ pem/                       # SSLè¯ä¹¦ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â””â”€â”€ static/                    # VR Webç•Œé¢é™æ€æ–‡ä»¶
â”œâ”€â”€ scripts/                       # å¯æ‰§è¡Œè„šæœ¬
â”‚   â””â”€â”€ vr_teleoperation_node      # ROS2èŠ‚ç‚¹å…¥å£è„šæœ¬
â”œâ”€â”€ launch.sh                      # ä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ CMakeLists.txt                 # CMakeæ„å»ºé…ç½®
â”œâ”€â”€ package.xml                    # ROS2åŒ…é…ç½®
â””â”€â”€ README.md                      # æœ¬æ–‡æ¡£
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# ç¡®ä¿ROS2 Humbleå·²å®‰è£…
source /opt/ros/humble/setup.bash

# å®‰è£…Pythonä¾èµ–
pip install aiohttp pyyaml numpy

# ROS2ä¾èµ–ï¼ˆé€šå¸¸å·²å®‰è£…ï¼‰
sudo apt install ros-humble-geometry-msgs ros-humble-std-msgs
```

### 2. æ„å»ºé¡¹ç›®

```bash
cd /home/airspeedbox/code/vr_robot_control_ws
colcon build --packages-select teleoperation_interface
source install/setup.bash
```

### 3. å¯åŠ¨ç³»ç»Ÿ

#### æ–¹æ³•1: ä½¿ç”¨ä¸€é”®å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd /home/airspeedbox/code/vr_robot_control_ws/src/teleoperation_interface
./launch.sh
```

#### æ–¹æ³•2: ä½¿ç”¨ROS2 Launch

```bash
cd /home/airspeedbox/code/vr_robot_control_ws
source install/setup.bash
ros2 launch teleoperation_interface vr_teleoperation.launch.py
```

#### æ–¹æ³•3: æ‰‹åŠ¨å¯åŠ¨ï¼ˆè°ƒè¯•ç”¨ï¼‰

```bash
# ç»ˆç«¯1: å¯åŠ¨VRæ•°æ®æœåŠ¡å™¨
python3 /home/airspeedbox/code/vr_robot_control_ws/src/teleoperation_interface/vr_teleoperation/vr_data_server.py

# ç»ˆç«¯2: å¯åŠ¨ROS2èŠ‚ç‚¹
source /opt/ros/humble/setup.bash
cd /home/airspeedbox/code/vr_robot_control_ws
python3 src/teleoperation_interface/vr_teleoperation/vr_teleoperation_node.py
```

### 4. è¿æ¥VRè®¾å¤‡

åœ¨VRè®¾å¤‡æµè§ˆå™¨ä¸­è®¿é—®ï¼š`https://[æœåŠ¡å™¨IP]:5000`

---

## ğŸ“‹ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### æ¨¡å—1: VR Data Server (`vr_data_server.py`)

**æ ¸å¿ƒèŒè´£**ï¼šæ¥æ”¶VRè®¾å¤‡HTTPSæ•°æ®ï¼Œå®æ—¶å‘å¸ƒåˆ°ROS2è¯é¢˜

**æŠ€æœ¯æ¶æ„**ï¼š
- **HTTPSæœåŠ¡å™¨**ï¼šåŸºäº`aiohttp`å¼‚æ­¥æ¡†æ¶
- **ROS2å‘å¸ƒå™¨**ï¼š`VRDataPublisherNode`ç±»
- **å¤šçº¿ç¨‹è®¾è®¡**ï¼šä¸»çº¿ç¨‹è¿è¡ŒHTTPæœåŠ¡ï¼Œåå°çº¿ç¨‹è¿è¡ŒROS2 spin

**å…³é”®API**ï¼š
- `POST /poseData` - æ¥æ”¶VRå§¿æ€æ•°æ®ï¼ˆä¸»è¦å…¥å£ï¼‰
- `GET /` - VR Webç•Œé¢
- `POST /adbConnect` - ADBè®¾å¤‡è¿æ¥
- `GET /vrData` - å·²åºŸå¼ƒï¼ˆè¿”å›410çŠ¶æ€ï¼‰

**æ•°æ®æµ**ï¼š
```python
VRè®¾å¤‡ â†’ HTTPS POST â†’ on_post_pose_data()
    â†’ ros_node.publish_vr_data(dict)
    â†’ ROS2è¯é¢˜ /vr_raw_data (JSONå­—ç¬¦ä¸²)
```

**ç‰¹æ€§**ï¼š
- âœ… è‡ªåŠ¨ç”ŸæˆSSLè¯ä¹¦
- âœ… ADBç«¯å£åå‘ä»£ç†æ”¯æŒ
- âœ… ç«¯å£å ç”¨æ£€æµ‹ä¸æ¸…ç†
- âœ… å¼‚æ­¥éé˜»å¡å¤„ç†ï¼ˆå»¶è¿Ÿ<2msï¼‰

---

### æ¨¡å—2: VR Teleoperation Node (`vr_teleoperation_node.py`)

**æ ¸å¿ƒèŒè´£**ï¼šè®¢é˜…åŸå§‹VRæ•°æ®ï¼Œæå–ã€è½¬æ¢ã€å‘å¸ƒæ ‡å‡†åŒ–å§¿æ€è¯é¢˜

**æ¶æ„è®¾è®¡ - æ··åˆæ¨¡å¼ï¼ˆSubscription + Timerï¼‰**ï¼š

```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®¢é˜…å™¨ (Subscription)                   â”‚
â”‚  â””â”€ Topic: /vr_raw_data                 â”‚
â”‚      â””â”€ Callback: vr_data_update_callback()
â”‚          â”œâ”€ çº¿ç¨‹å®‰å…¨é” (Lock)            â”‚
â”‚          â”œâ”€ å¿«é€Ÿç¼“å­˜æœ€æ–°æ•°æ®             â”‚
â”‚          â””â”€ ç«‹å³è¿”å›ï¼ˆ<0.1msï¼Œéé˜»å¡ï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    æœ€æ–°æ•°æ®ç¼“å­˜ (latest_vr_data)
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®šæ—¶å™¨ (Timer, 10Hz = 100ms)           â”‚
â”‚  â””â”€ Callback: publish_callback()        â”‚
â”‚      â”œâ”€ è¯»å–ç¼“å­˜æ•°æ®                     â”‚
â”‚      â”œâ”€ JSONè§£æ                        â”‚
â”‚      â”œâ”€ æ•°æ®æå– (head/left/right)      â”‚
â”‚      â”œâ”€ åæ ‡è½¬æ¢ (VR â†’ æ ‡å‡†)            â”‚
â”‚      â””â”€ æ‰¹é‡å‘å¸ƒROS2è¯é¢˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ºä»€ä¹ˆä½¿ç”¨æ··åˆæ¨¡å¼ï¼Ÿ**
- âŒ çº¯äº‹ä»¶é©±åŠ¨ï¼šVRé¢‘ç‡ä¸ç¨³å®šï¼ˆ60-90Hzæ³¢åŠ¨ï¼‰â†’ æœºå™¨äººæŠ–åŠ¨
- âŒ çº¯å®šæ—¶å™¨ï¼šéœ€è¦æ–‡ä»¶ä¸­ä»‹ â†’ å·²ç§»é™¤JSONæ–‡ä»¶ä¾èµ–
- âœ… æ··åˆæ¨¡å¼ï¼šè®¢é˜…å™¨å¿«é€Ÿç¼“å­˜ + å®šæ—¶å™¨ç¨³å®šè¾“å‡º â†’ å®Œç¾å¹³è¡¡

**æ•°æ®å¤„ç†æµç¨‹**ï¼š
```
åŸå§‹JSON â†’ æå–å­—æ®µ â†’ åæ ‡è½¬æ¢ â†’ åˆ›å»ºROS2æ¶ˆæ¯ â†’ å‘å¸ƒè¯é¢˜
  (1ms)     (0.5ms)     (0.5ms)       (0.3ms)      (0.2ms)
```

**å‘å¸ƒçš„ROS2è¯é¢˜**ï¼š

| è¯é¢˜åç§° | æ¶ˆæ¯ç±»å‹ | é¢‘ç‡ | å†…å®¹ |
|---------|---------|------|------|
| `/target_head_pose` | `geometry_msgs/PoseStamped` | 10Hz | å¤´æ˜¾ä½ç½®+æ—‹è½¬ |
| `/target_left_arm_pose` | `geometry_msgs/PoseStamped` | 10Hz | å·¦æ‰‹æŸ„ä½ç½®+æ—‹è½¬ |
| `/target_left_buttons` | `std_msgs/Float32MultiArray` | äº‹ä»¶é©±åŠ¨ | å·¦æ‰‹æŸ„æŒ‰é’®çŠ¶æ€ |
| `/target_right_arm_pose` | `geometry_msgs/PoseStamped` | 10Hz | å³æ‰‹æŸ„ä½ç½®+æ—‹è½¬ |
| `/target_right_buttons` | `std_msgs/Float32MultiArray` | äº‹ä»¶é©±åŠ¨ | å³æ‰‹æŸ„æŒ‰é’®çŠ¶æ€ |

---

## âš™ï¸ é…ç½®æ–‡ä»¶è¯¦è§£

### 1. æœåŠ¡å™¨é…ç½® (`config/config.json`)

```json
{
  "ip": "127.0.0.1",    // HTTPSæœåŠ¡å™¨ç›‘å¬åœ°å€
  "port": 5000          // HTTPSæœåŠ¡å™¨ç«¯å£
}
```

### 2. èŠ‚ç‚¹é…ç½® (`config/teleoperation_config.yaml`)

```yaml
# æ•°æ®æå–é…ç½®
useful_fields:
  head:
    - position      # æå–å¤´æ˜¾ä½ç½®
    - rotation      # æå–å¤´æ˜¾æ—‹è½¬
  left:
    - position      # æå–å·¦æ‰‹æŸ„ä½ç½®
    - rotation      # æå–å·¦æ‰‹æŸ„æ—‹è½¬
    - button        # æå–å·¦æ‰‹æŸ„æŒ‰é’®
  right:
    - position      # æå–å³æ‰‹æŸ„ä½ç½®
    - rotation      # æå–å³æ‰‹æŸ„æ—‹è½¬
    - button        # æå–å³æ‰‹æŸ„æŒ‰é’®

# åæ ‡è½¬æ¢é…ç½®ï¼ˆVRåæ ‡ç³» â†’ æ ‡å‡†åæ ‡ç³»ï¼‰
coordinate_transformation:
  transformation_matrix:
    - [-1, 0, 0]  # Xè½´å–åï¼ˆVRå³ â†’ æ ‡å‡†å·¦ï¼‰
    - [0, 1, 0]   # Yè½´ä¿æŒï¼ˆå‘ä¸Šï¼‰
    - [0, 0, 1]   # Zè½´ä¿æŒï¼ˆå‘å‰ï¼‰
  transform_position: true    # å¯ç”¨ä½ç½®è½¬æ¢
  transform_rotation: true    # å¯ç”¨æ—‹è½¬è½¬æ¢

# ROS2å‘å¸ƒé…ç½®
ros_publish:
  enabled: true           # å¯ç”¨ROS2å‘å¸ƒ
  publish_rate: 10.0      # å‘å¸ƒé¢‘ç‡ï¼ˆHzï¼‰- åŒ¹é…æœºå™¨äººå·¥ä½œé¢‘ç‡
  topics:
    head:
      topic_name: "/target_head_pose"
      frame_id: "world"
    left:
      topic_name: "/target_left_arm_pose"
      button_topic_name: "/target_left_buttons"
      frame_id: "world"
    right:
      topic_name: "/target_right_arm_pose"
      button_topic_name: "/target_right_buttons"
      frame_id: "world"
```

---

## ğŸ”„ åæ ‡ç³»ç»Ÿè¯¦è§£

### VRåæ ‡ç³»ï¼ˆUnity/OpenXRæ ‡å‡†ï¼‰
- **Xè½´**ï¼šå‘å³ä¸ºæ­£
- **Yè½´**ï¼šå‘ä¸Šä¸ºæ­£
- **Zè½´**ï¼šå‘å‰ä¸ºæ­£
- **æ—‹è½¬**ï¼šå››å…ƒæ•° (x, y, z, w)

### æ ‡å‡†æœºå™¨äººåæ ‡ç³»
- **Xè½´**ï¼šå‘å·¦ä¸ºæ­£ï¼ˆä¸VRç›¸åï¼‰
- **Yè½´**ï¼šå‘ä¸Šä¸ºæ­£
- **Zè½´**ï¼šå‘å‰ä¸ºæ­£
- **æ—‹è½¬**ï¼šå››å…ƒæ•° (x, y, z, w)

### è½¬æ¢çŸ©é˜µ
```python
# ä½ç½®è½¬æ¢
transform_matrix = [[-1, 0, 0],
                    [0, 1, 0],
                    [0, 0, 1]]
standard_position = transform_matrix @ vr_position

# æ—‹è½¬è½¬æ¢ï¼ˆå››å…ƒæ•°ï¼‰
# ç»•Yè½´ç¿»è½¬180åº¦
rotation_correction = [0, 1, 0, 0]  # (x, y, z, w)
standard_quaternion = rotation_correction * vr_quaternion
```

---

## ğŸ› ï¸ ä½¿ç”¨æŒ‡å—

### ç›‘æ§ROS2è¯é¢˜

```bash
# æŸ¥çœ‹æ‰€æœ‰è¯é¢˜
ros2 topic list

# å®æ—¶ç›‘æ§å¤´æ˜¾å§¿æ€
ros2 topic echo /target_head_pose

# å®æ—¶ç›‘æ§å³æ‰‹æŸ„å§¿æ€
ros2 topic echo /target_right_arm_pose

# å®æ—¶ç›‘æ§æŒ‰é’®çŠ¶æ€
ros2 topic echo /target_right_buttons

# æŸ¥çœ‹è¯é¢˜é¢‘ç‡
ros2 topic hz /target_right_arm_pose

# æŸ¥çœ‹åŸå§‹VRæ•°æ®
ros2 topic echo /vr_raw_data
```

### æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€

```bash
# æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨
ros2 node list

# æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯
ros2 node info /vr_teleoperation_node
ros2 node info /vr_data_publisher

# æŸ¥çœ‹è¯é¢˜è¿æ¥å…³ç³»
ros2 topic info /target_right_arm_pose
```

### è°ƒè¯•æ¨¡å¼

```bash
# ä»¥è°ƒè¯•æ—¥å¿—çº§åˆ«å¯åŠ¨
ros2 run teleoperation_interface vr_teleoperation_node --ros-args --log-level debug

# æŸ¥çœ‹ROS2æ—¥å¿—
ros2 run teleoperation_interface vr_teleoperation_node --ros-args --log-level info
```

---

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1: VRè®¾å¤‡æ— æ³•è¿æ¥

**ç—‡çŠ¶**ï¼šVRè®¾å¤‡æ— æ³•è®¿é—®HTTPSæœåŠ¡å™¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :5000

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw allow 5000

# æ£€æŸ¥ADBè¿æ¥ï¼ˆAndroid VRè®¾å¤‡ï¼‰
adb devices
adb reverse tcp:5000 tcp:5000
```

### é—®é¢˜2: ROS2è¯é¢˜æ— æ•°æ®

**ç—‡çŠ¶**ï¼š`ros2 topic echo /target_right_arm_pose` æ— è¾“å‡º

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦è¿è¡Œ
ros2 node list

# 2. æ£€æŸ¥/vr_raw_dataè¯é¢˜
ros2 topic echo /vr_raw_data

# 3. æ£€æŸ¥é…ç½®æ–‡ä»¶è·¯å¾„
ls -la src/teleoperation_interface/config/teleoperation_config.yaml

# 4. é‡å¯èŠ‚ç‚¹å¹¶æŸ¥çœ‹æ—¥å¿—
ros2 run teleoperation_interface vr_teleoperation_node --ros-args --log-level debug
```

### é—®é¢˜3: Pythonç‰ˆæœ¬å†²çª

**ç—‡çŠ¶**ï¼š`ModuleNotFoundError: No module named 'rclpy._rclpy_pybind11'`

**åŸå› **ï¼šCondaç¯å¢ƒçš„Python 3.12ä¸ROS2 Humbleçš„Python 3.10ä¸å…¼å®¹

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# launch.shå·²è‡ªåŠ¨å¤„ç†ï¼Œæ‰‹åŠ¨å¯åŠ¨æ—¶éœ€è¦ï¼š
conda deactivate  # é€€å‡ºcondaç¯å¢ƒ
/usr/bin/python3 src/teleoperation_interface/vr_teleoperation/vr_data_server.py
```

### é—®é¢˜4: æ•°æ®é¢‘ç‡ä¸ç¨³å®š

**ç—‡çŠ¶**ï¼šæœºå™¨äººè¿åŠ¨æŠ–åŠ¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥`publish_rate`é…ç½®ï¼ˆåº”ä¸º10.0Hzï¼‰
- ç¡®è®¤å®šæ—¶å™¨æ¨¡å¼å·²å¯ç”¨ï¼ˆæ—¥å¿—æ˜¾ç¤º"Using TIMER mode"ï¼‰
- æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿï¼ˆping VRè®¾å¤‡ï¼‰

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|-----|------|------|
| **ç«¯åˆ°ç«¯å»¶è¿Ÿ** | < 5ms | VRè®¾å¤‡ â†’ ROS2è¯é¢˜ |
| **HTTPSå¤„ç†** | ~2ms | æ¥æ”¶å¹¶å‘å¸ƒåŸå§‹æ•°æ® |
| **æ•°æ®å¤„ç†** | ~2ms | æå–+è½¬æ¢+å‘å¸ƒ |
| **è¾“å‡ºé¢‘ç‡** | ç¨³å®š10Hz | å®šæ—¶å™¨ä¿è¯ |
| **å†…å­˜å ç”¨** | < 80MB | ä¸¤ä¸ªèŠ‚ç‚¹æ€»è®¡ |
| **CPUå ç”¨** | < 5% | æ­£å¸¸è¿è¡Œæ—¶ |
| **ç½‘ç»œå¸¦å®½** | < 1Mbps | VRæ•°æ®ä¼ è¾“ |

---

## ğŸ”’ å®‰å…¨è€ƒè™‘

- âœ… **HTTPSåŠ å¯†**ï¼šæ‰€æœ‰VRæ•°æ®é€šè¿‡SSL/TLSä¼ è¾“
- âœ… **è‡ªç­¾åè¯ä¹¦**ï¼šè‡ªåŠ¨ç”Ÿæˆï¼Œå¼€å‘ç¯å¢ƒä½¿ç”¨
- âœ… **ç«¯å£éš”ç¦»**ï¼š5000ç«¯å£ä»…æœ¬åœ°æˆ–å†…ç½‘è®¿é—®
- âš ï¸ **ç”Ÿäº§ç¯å¢ƒ**ï¼šå»ºè®®ä½¿ç”¨æ­£å¼CAè¯ä¹¦

---

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°è®¾å¤‡æ”¯æŒ

1. ä¿®æ”¹`config/teleoperation_config.yaml`ï¼š
```yaml
useful_fields:
  new_device:
    - position
    - rotation
```

2. åœ¨`vr_teleoperation_node.py`ä¸­æ·»åŠ è¯é¢˜é…ç½®ï¼š
```yaml
ros_publish:
  topics:
    new_device:
      topic_name: "/target_new_device_pose"
```

### è‡ªå®šä¹‰åæ ‡è½¬æ¢

ä¿®æ”¹`transformation_matrix`ä»¥é€‚åº”ä¸åŒçš„åæ ‡ç³»çº¦å®šï¼š
```yaml
coordinate_transformation:
  transformation_matrix:
    - [0, -1, 0]  # è‡ªå®šä¹‰Xè½´æ˜ å°„
    - [1, 0, 0]   # è‡ªå®šä¹‰Yè½´æ˜ å°„
    - [0, 0, 1]   # è‡ªå®šä¹‰Zè½´æ˜ å°„
```

### è°ƒæ•´è¾“å‡ºé¢‘ç‡

```yaml
ros_publish:
  publish_rate: 20.0  # æé«˜åˆ°20Hzï¼ˆéœ€ç¡®ä¿æœºå™¨äººæ”¯æŒï¼‰
```

---

## ğŸ“ æŠ€æœ¯äº®ç‚¹

1. **ROS2åŸç”Ÿé€šä¿¡**ï¼šå®Œå…¨ç§»é™¤JSONæ–‡ä»¶ä¾èµ–ï¼Œå®ç°çœŸæ­£çš„æµå¼å¤„ç†
2. **æ··åˆå®šæ—¶å™¨æ¶æ„**ï¼šå¹³è¡¡å®æ—¶æ€§ä¸ç¨³å®šæ€§
3. **çº¿ç¨‹å®‰å…¨è®¾è®¡**ï¼šLockä¿æŠ¤å…±äº«æ•°æ®
4. **å¼‚æ­¥HTTPæœåŠ¡å™¨**ï¼šaiohttp + ROS2å¤šçº¿ç¨‹é›†æˆ
5. **æ¨¡å—åŒ–è®¾è®¡**ï¼šæå–ã€è½¬æ¢ã€å‘å¸ƒå®Œå…¨è§£è€¦

---

## ğŸ“„ ä¾èµ–é¡¹

### ç³»ç»Ÿä¾èµ–
- Ubuntu 22.04 (æ¨è)
- ROS2 Humble
- Python 3.10

### PythonåŒ…
- `rclpy` - ROS2 Pythonå®¢æˆ·ç«¯
- `aiohttp` - å¼‚æ­¥HTTPæœåŠ¡å™¨
- `numpy` - æ•°å€¼è®¡ç®—ï¼ˆçŸ©é˜µå˜æ¢ï¼‰
- `pyyaml` - YAMLé…ç½®è§£æ
- `geometry_msgs` - ROS2å‡ ä½•æ¶ˆæ¯
- `std_msgs` - ROS2æ ‡å‡†æ¶ˆæ¯

---

## ğŸ“ æ”¯æŒä¸åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
- æŸ¥çœ‹æ—¥å¿—è¾“å‡ºè¿›è¡Œè°ƒè¯•
- æ£€æŸ¥é…ç½®æ–‡ä»¶å‚æ•°
- ç¡®è®¤ROS2ç¯å¢ƒæ­£ç¡®åŠ è½½
- éªŒè¯ç½‘ç»œè¿æ¥çŠ¶æ€

---

**æ³¨æ„**ï¼šæœ¬ç³»ç»Ÿå·²ä¼˜åŒ–ä¸ºç”Ÿäº§çº§åˆ«æ¶æ„ï¼Œå…·æœ‰ä½å»¶è¿Ÿã€é«˜ç¨³å®šæ€§å’Œè‰¯å¥½çš„å¯æ‰©å±•æ€§ã€‚ğŸš€
