# Robot Interface - æœºå™¨äººæ¥å£
# VRæœºå™¨äººé¥æ“ä½œå¹³å° - æœºå™¨äººæ¥å£éƒ¨åˆ†

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯åŸºäºROS2æ¡†æ¶çš„VRæœºå™¨äººé¥æ“ä½œå¹³å°çš„**æœºå™¨äººæ¥å£éƒ¨åˆ†**ã€‚è¯¥æ¥å£è´Ÿè´£æ¥æ”¶é¥æ“ä½œæ¥å£å‘å¸ƒçš„ROS2è¯é¢˜ï¼Œè¿›è¡Œæ•°æ®å¤„ç†å’Œåæ ‡è½¬æ¢ï¼Œç„¶åæ§åˆ¶æœºå™¨äººæ‰§è¡Œç›¸åº”åŠ¨ä½œï¼Œå¹¶å®æ—¶å›ä¼ æœºå™¨äººçŠ¶æ€æ•°æ®ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- âœ… **é€šç”¨APIæ¶æ„**ï¼ˆé…ç½®é©±åŠ¨ï¼Œè½»æ¾æ›´æ¢æœºå™¨äººï¼‰
- âœ… å¼‚æ­¥å‘½ä»¤é˜Ÿåˆ—ï¼ˆæ¶ˆé™¤å»¶è¿Ÿï¼‰
- âœ… ä¸‰å±‚é™é‡‡æ ·ç­–ç•¥ï¼ˆåŒ¹é…æœºå™¨äºº10Hzèƒ½åŠ›ï¼‰
- âœ… çŠ¶æ€æœºæ§åˆ¶é€»è¾‘ï¼ˆå®‰å…¨å¯é ï¼‰
- âœ… å®æ—¶æ•°æ®å›ä¼ ï¼ˆ10Hzï¼‰
- âœ… æ¨¡å—åŒ–æ¶æ„è®¾è®¡

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
é¥æ“ä½œæ¥å£ (Teleoperation Interface)
    â”‚
    â”‚ ROS2 Topics (10Hz)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Robot Interface Node                              â”‚
â”‚  (robot_interface_node.py)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  [ROS2è®¢é˜…å™¨]                                       â”‚
â”‚  â”œâ”€ /target_right_arm_pose  â†’ pose_callback()    â”‚
â”‚  â””â”€ /target_right_buttons   â†’ button_callback()  â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  DataExtractor (æ•°æ®æå–æ¨¡å—)         â”‚         â”‚
â”‚  â”‚  - æå–ä½ç½®ã€æ—‹è½¬ã€æŒ‰é’®æ•°æ®            â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚              â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  DataTransformer (åæ ‡è½¬æ¢æ¨¡å—)       â”‚         â”‚
â”‚  â”‚  - æ ‡å‡†åæ ‡ç³» â†’ æœºå™¨äººåæ ‡ç³»          â”‚         â”‚
â”‚  â”‚  - å››å…ƒæ•° â†’ æ¬§æ‹‰è§’                   â”‚         â”‚
â”‚  â”‚  - å•ä½è½¬æ¢: m â†’ mm                  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚              â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  RobotController (æ§åˆ¶å™¨)             â”‚         â”‚
â”‚  â”‚  â”œâ”€ çŠ¶æ€æœº (4ä¸ªçŠ¶æ€)                  â”‚         â”‚
â”‚  â”‚  â”œâ”€ é™æµæœºåˆ¶ (10Hz + 2mmé˜ˆå€¼)         â”‚         â”‚
â”‚  â”‚  â””â”€ å¼‚æ­¥å‘½ä»¤é˜Ÿåˆ— â­                   â”‚         â”‚
â”‚  â”‚      â”œâ”€ ä¸»çº¿ç¨‹ï¼šå¿«é€Ÿå…¥é˜Ÿ               â”‚         â”‚
â”‚  â”‚      â””â”€ å·¥ä½œçº¿ç¨‹ï¼šé˜»å¡æ‰§è¡Œ             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚              â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  DataFeedbackModule (æ•°æ®å›ä¼ )        â”‚         â”‚
â”‚  â”‚  - å®šæ—¶å™¨: 10Hz                       â”‚         â”‚
â”‚  â”‚  - å…³èŠ‚è§’åº¦åé¦ˆ                        â”‚         â”‚
â”‚  â”‚  - ç¬›å¡å°”ä½å§¿åé¦ˆ                      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  é€šç”¨APIå±‚ â­                         â”‚         â”‚
â”‚  â”‚  - call_robot_api()                  â”‚         â”‚
â”‚  â”‚  - åŠ¨æ€æ–¹æ³•è°ƒç”¨ (getattr)             â”‚         â”‚
â”‚  â”‚  - é…ç½®é©±åŠ¨çš„å‘½ä»¤æ˜ å°„                 â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ æœºå™¨äººSDK (å¯æ›´æ¢)
    â”‚ - pymycobot.ElephantRobot (å½“å‰)
    â”‚ - urx.Robot (URæœºå™¨äºº)
    â”‚ - franka.Robot (Frankaæœºå™¨äºº)
    â”‚ - å…¶ä»–å“ç‰Œ...
    â†“
å®é™…æœºæ¢°è‡‚ç¡¬ä»¶
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
robot_interface/
â”œâ”€â”€ elephant_robot/                # æ ¸å¿ƒèŠ‚ç‚¹æ–‡ä»¶å¤¹
â”‚   â””â”€â”€ robot_interface_node.py    # æœºå™¨äººæ¥å£æ ¸å¿ƒèŠ‚ç‚¹
â”œâ”€â”€ launch/                        # ROS2å¯åŠ¨æ–‡ä»¶
â”‚   â””â”€â”€ robot_interface.launch.py  # å¯åŠ¨é…ç½®
â”œâ”€â”€ config/                        # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ robot_config.yaml          # æœºå™¨äººé…ç½®ï¼ˆè¿æ¥ã€æ§åˆ¶ã€å›ä¼ ï¼‰
â”œâ”€â”€ else/                          # å…¶ä»–æ–‡ä»¶
â”‚   â”œâ”€â”€ README.md                  # æœ¬æ–‡æ¡£
â”‚   â””â”€â”€ robot.md                   # æœºå™¨äººç›¸å…³æ–‡æ¡£
â”œâ”€â”€ scripts/                       # å¯æ‰§è¡Œè„šæœ¬
â”‚   â””â”€â”€ robot_interface_node       # ROS2èŠ‚ç‚¹å…¥å£è„šæœ¬
â”œâ”€â”€ launch.sh                      # ä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ CMakeLists.txt                 # CMakeæ„å»ºé…ç½®
â””â”€â”€ package.xml                    # ROS2åŒ…é…ç½®
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# ç¡®ä¿ROS2 Humbleå·²å®‰è£…
source /opt/ros/humble/setup.bash

# å®‰è£…Pythonä¾èµ–
pip install numpy pyyaml pymycobot

# ROS2ä¾èµ–
sudo apt install ros-humble-geometry-msgs ros-humble-std-msgs
```

### 2. é…ç½®æœºå™¨äºº

ç¼–è¾‘ `config/robot_config.yaml`ï¼Œè®¾ç½®æœºå™¨äººIPåœ°å€ï¼š

```yaml
robot_connection:
  ip: "192.168.10.150"  # ä¿®æ”¹ä¸ºå®é™…IP
  port: 5001
```

### 3. æ„å»ºé¡¹ç›®

```bash
cd /home/airspeedbox/code/vr_robot_control_ws
colcon build --packages-select robot_interface
source install/setup.bash
```

### 4. å¯åŠ¨ç³»ç»Ÿ

#### æ–¹æ³•1: ä½¿ç”¨ä¸€é”®å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd /home/airspeedbox/code/vr_robot_control_ws/src/robot_interface
./launch.sh
```

#### æ–¹æ³•2: ä½¿ç”¨ROS2 Launch

```bash
cd /home/airspeedbox/code/vr_robot_control_ws
source install/setup.bash
ros2 launch robot_interface robot_interface.launch.py
```

#### æ–¹æ³•3: æ‰‹åŠ¨å¯åŠ¨ï¼ˆè°ƒè¯•ç”¨ï¼‰

```bash
source /opt/ros/humble/setup.bash
cd /home/airspeedbox/code/vr_robot_control_ws
python3 src/robot_interface/elephant_robot/robot_interface_node.py
```

---

## ğŸ“‹ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### æ¨¡å—1: DataExtractor (æ•°æ®æå–æ¨¡å—)

**åŠŸèƒ½**ï¼šä»ROS2æ¶ˆæ¯ä¸­æå–æ‰€éœ€å­—æ®µ

```python
è¾“å…¥: geometry_msgs/PoseStamped, std_msgs/Float32MultiArray
  â†“
æå–:
  - position: {x, y, z}
  - orientation: {x, y, z, w} (å››å…ƒæ•°)
  - buttons: [A, B, trigger, side, H, ...]
  â†“
è¾“å‡º: Pythonå­—å…¸
```

**é…ç½®é©±åŠ¨**ï¼š
```yaml
useful_fields:
  right_arm:
    position: {x: true, y: true, z: true}
    rotation: {x: true, y: true, z: true, w: true}
```

---

### æ¨¡å—2: DataTransformer (åæ ‡è½¬æ¢æ¨¡å—)

**åŠŸèƒ½**ï¼šåæ ‡ç³»ç»Ÿè½¬æ¢å’Œæ•°æ®æ ¼å¼è½¬æ¢

#### åæ ‡ç³»è½¬æ¢

```
æ ‡å‡†åæ ‡ç³»             æœºå™¨äººåæ ‡ç³»
X: å‘å·¦ä¸ºæ­£      â†’    X: å‘å³ä¸ºæ­£ (å–å)
Y: å‘ä¸Šä¸ºæ­£      â†’    Y: å‘ä¸Šä¸ºæ­£ (ä¿æŒ)
Z: å‘å‰ä¸ºæ­£      â†’    Z: å‘å‰ä¸ºæ­£ (ä¿æŒ)

è½¬æ¢çŸ©é˜µ: [[-1, 0, 0],
          [0, 1, 0],
          [0, 0, 1]]
```

#### å››å…ƒæ•°è½¬æ¬§æ‹‰è§’

```python
è¾“å…¥: quaternion (x, y, z, w)
  â†“
è½¬æ¢: ZYXæ¬§æ‹‰è§’é¡ºåº
  â†“
è¾“å‡º: (rx, ry, rz) å•ä½ï¼šåº¦
```

#### å•ä½è½¬æ¢

```python
ä½ç½®: ç±³(m) â†’ æ¯«ç±³(mm)
[0.5, 0.3, 0.4] â†’ [500, 300, 400]
```

---

### æ¨¡å—3: RobotController (æœºå™¨äººæ§åˆ¶å™¨) â­æ ¸å¿ƒ

è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿæœ€å…³é”®çš„æ¨¡å—ï¼Œè´Ÿè´£å®é™…çš„æœºå™¨äººè¿åŠ¨æ§åˆ¶ã€‚

#### 3.1 çŠ¶æ€æœºè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [1] waiting_for_calibration (åˆå§‹çŠ¶æ€)         â”‚
â”‚      ç­‰å¾…: AæŒ‰é’®æŒ‰ä¸‹                             â”‚
â”‚      åŠ¨ä½œ: è®°å½•èµ·å§‹ä½ç½® + ç§»åŠ¨åˆ°base_position   â”‚
â”‚      è½¬åˆ°: waiting_for_control                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [2] waiting_for_control (å·²æ ‡å®š)               â”‚
â”‚      ç­‰å¾…: BæŒ‰é’®æŒ‰ä¸‹                             â”‚
â”‚      åŠ¨ä½œ: è¿›å…¥å‡†å¤‡çŠ¶æ€                          â”‚
â”‚      è½¬åˆ°: ready_to_control                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [3] ready_to_control (å‡†å¤‡æ§åˆ¶)                â”‚
â”‚      ç­‰å¾…: SecondæŒ‰é’®æŒç»­æŒ‰ä¸‹                    â”‚
â”‚      åŠ¨ä½œ: å¼€å§‹æ§åˆ¶å¾ªç¯                          â”‚
â”‚      è½¬åˆ°: controlling                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [4] controlling (æ­£åœ¨æ§åˆ¶) â­                  â”‚
â”‚      æ¡ä»¶: SecondæŒ‰é’®æŒç»­æŒ‰ä¸‹                    â”‚
â”‚      åŠ¨ä½œ:                                       â”‚
â”‚        1. è®¡ç®—ç›¸å¯¹ä½ç§»                           â”‚
â”‚        2. æ£€æŸ¥é™æµæ¡ä»¶                           â”‚
â”‚        3. å‘é€å‘½ä»¤åˆ°å¼‚æ­¥é˜Ÿåˆ—                     â”‚
â”‚      é‡Šæ”¾SecondæŒ‰é’® â†’ ready_to_control          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŒ‰é’®æ˜ å°„**ï¼š
- **AæŒ‰é’®**: æ ‡å®šèµ·å§‹ä½ç½®
- **BæŒ‰é’®**: å¯åŠ¨æ§åˆ¶æ¨¡å¼
- **SecondæŒ‰é’®**: æ­»äººå¼€å…³ï¼ˆå¿…é¡»æŒç»­æŒ‰ä¸‹ï¼‰
- **HæŒ‰é’®**: å¤¹çˆªå¼€å…³

#### 3.2 å¼‚æ­¥å‘½ä»¤é˜Ÿåˆ—ï¼ˆè§£å†³å»¶è¿Ÿçš„å…³é”®ï¼‰

**é—®é¢˜èƒŒæ™¯**ï¼š
```python
# åŸå§‹é—®é¢˜ï¼šwrite_coords()é˜»å¡50-100ms
def pose_callback(msg):
    mc.write_coords(target, speed)  # âŒ é˜»å¡ROS2å›è°ƒçº¿ç¨‹
    # ç»“æœï¼šæ–°æ¶ˆæ¯å †ç§¯ â†’ å»¶è¿Ÿç´¯ç§¯ â†’ ç”¨æˆ·æ„ŸçŸ¥å»¶è¿Ÿ
```

**è§£å†³æ–¹æ¡ˆ**ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼

```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸»çº¿ç¨‹ (ROS2å›è°ƒ)                       â”‚
â”‚  - pose_callback()                      â”‚
â”‚  - æ•°æ®å¤„ç† (~2ms)                       â”‚
â”‚  - _send_command_async()                â”‚
â”‚      â””â”€ queue.put(cmd) [éé˜»å¡]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    Command Queue (maxsize=2)
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·¥ä½œçº¿ç¨‹ (ç‹¬ç«‹è¿è¡Œ)                     â”‚
â”‚  - _command_worker()                    â”‚
â”‚  - cmd = queue.get() [é˜»å¡ç­‰å¾…]         â”‚
â”‚  - mc.write_coords(cmd) [é˜»å¡50ms]     â”‚
â”‚      â””â”€ ä¸å½±å“ä¸»çº¿ç¨‹                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é˜Ÿåˆ—ç®¡ç†ç­–ç•¥**ï¼š
- `maxsize=2`ï¼š1ä¸ªæ‰§è¡Œä¸­ + 1ä¸ªæ’é˜Ÿï¼ˆæœ€æ–°ï¼‰
- é˜Ÿåˆ—æ»¡æ—¶ï¼šè‡ªåŠ¨ä¸¢å¼ƒæœ€æ—§å‘½ä»¤
- ä¿è¯ï¼šå§‹ç»ˆæ‰§è¡Œæœ€æ–°å‘½ä»¤ï¼Œæ— å»¶è¿Ÿç´¯ç§¯

#### 3.3 ä¸‰å±‚é™é‡‡æ ·ç­–ç•¥

```
[ç¬¬1å±‚] é¥æ“ä½œæ¥å£è¾“å‡º: ç¨³å®š10Hz
    â†“
[ç¬¬2å±‚] æ§åˆ¶å™¨é™æµ:
    â”œâ”€ æ—¶é—´é—´éš”: â‰¥100ms (10Hz)
    â”œâ”€ ä½ç½®é˜ˆå€¼: â‰¥2mm
    â””â”€ ä¸¤è€…åŒæ—¶æ»¡è¶³æ‰å‘é€
    â†“
[ç¬¬3å±‚] å¼‚æ­¥é˜Ÿåˆ—:
    â”œâ”€ ä¸¢å¼ƒè¿‡æ—¶å‘½ä»¤
    â””â”€ ä¿æŒé˜Ÿåˆ—æœ€æ–°
    â†“
å®é™…æœºå™¨äººå‘½ä»¤: â‰¤10Hz é«˜è´¨é‡æŒ‡ä»¤
```

**é…ç½®å‚æ•°**ï¼š
```yaml
data_processing:
  robot_control_rate: 10.0           # é™æµé¢‘ç‡
  position_change_threshold: 0.002   # 2mmé˜ˆå€¼
```

---

### æ¨¡å—4: DataFeedbackModule (æ•°æ®å›ä¼ æ¨¡å—)

**åŠŸèƒ½**ï¼šå®æ—¶è·å–æœºå™¨äººçŠ¶æ€å¹¶å‘å¸ƒROS2è¯é¢˜

```python
å®šæ—¶å™¨ (10Hz) â†’ è·å–æœºå™¨äººæ•°æ® â†’ å‘å¸ƒROS2è¯é¢˜
    â†“               â†“                   â†“
  100ms       mc.get_angles()    /robot_joint_angles
              mc.get_coords()    /robot_cartesian_pose
```

**å‘å¸ƒçš„è¯é¢˜**ï¼š

| è¯é¢˜åç§° | æ¶ˆæ¯ç±»å‹ | é¢‘ç‡ | å†…å®¹ |
|---------|---------|------|------|
| `/robot_joint_angles` | `std_msgs/Float32MultiArray` | 10Hz | 6ä¸ªå…³èŠ‚è§’åº¦(åº¦) |
| `/robot_cartesian_pose` | `geometry_msgs/PoseStamped` | 10Hz | ç¬›å¡å°”ä½å§¿(x,y,z,rx,ry,rz) |

---

## âš™ï¸ é…ç½®æ–‡ä»¶è¯¦è§£

### robot_config.yaml

```yaml
robot_interface:
  ros__parameters:
    # æœºå™¨äººè¿æ¥é…ç½®
    robot_connection:
      type: "ElephantRobot"
      ip: "192.168.10.150"        # æœºå™¨äººIP
      port: 5001
      test_mode: false             # æµ‹è¯•æ¨¡å¼ï¼ˆæ— éœ€å®é™…æœºå™¨äººï¼‰

    # æœºå™¨äººæ§åˆ¶é…ç½®
    robot_control:
      # åŸºåº§ä½ç½®ï¼ˆåˆå§‹ä½ç½®ï¼‰
      base_position: [180, 200, 340, -90, 0, 90]
      
      motion:
        position_scale: 500.0      # ä½ç§»ç¼©æ”¾ç³»æ•°
        speed: 50                  # è¿åŠ¨é€Ÿåº¦(1-100)
        initial_angles: [0, 0, 0, 0, -90, 0]
      
      gripper:
        initial_state: 0           # åˆå§‹çŠ¶æ€(0=å¼€, 1=é—­)
        speed: 50                  # å¤¹çˆªé€Ÿåº¦
        mode: 0                    # å¤¹çˆªæ¨¡å¼
      
      # â­ é€šç”¨APIå‘½ä»¤æ˜ å°„é…ç½®ï¼ˆæ›´æ¢æœºå™¨äººçš„å…³é”®ï¼‰
      # è¯´æ˜ï¼šå°†é€šç”¨å‘½ä»¤åæ˜ å°„åˆ°å…·ä½“æœºå™¨äººçš„APIæ–¹æ³•å
      # æ›´æ¢æœºå™¨äººæ—¶åªéœ€ä¿®æ”¹ä»¥ä¸‹APIæ–¹æ³•åå³å¯
      commands:
        # === åˆå§‹åŒ–ç›¸å…³æŒ‡ä»¤ ===
        power_on_command: "_power_on"               # ç”µæºå¼€å¯
        start_robot_command: "start_robot"          # å¯åŠ¨æœºå™¨äºº
        get_state_command: "get_robot_state"        # è·å–çŠ¶æ€
        speed_command: "set_speed"                  # è®¾ç½®é€Ÿåº¦
        
        # === è¿åŠ¨æ§åˆ¶æŒ‡ä»¤ ===
        position_command: "write_coords"            # ä½ç½®æ§åˆ¶(å‚æ•°: position[6], speed)
        angle_command: "write_angles"               # è§’åº¦æ§åˆ¶(å‚æ•°: angles[6], speed)
        wait_command: "command_wait_done"           # ç­‰å¾…å®Œæˆ
        
        # === å¤¹çˆªæ§åˆ¶æŒ‡ä»¤ ===
        gripper_mode_command: "set_gripper_mode"    # å¤¹çˆªæ¨¡å¼(å‚æ•°: mode)
        gripper_state_command: "set_gripper_state"  # å¤¹çˆªçŠ¶æ€(å‚æ•°: state, speed)
        
        # === æ•°æ®è·å–æŒ‡ä»¤ ===
        get_angles_command: "get_angles"            # è·å–å…³èŠ‚è§’åº¦(è¿”å›: angles[6])
        get_coords_command: "get_coords"            # è·å–åæ ‡(è¿”å›: coords[6])

    # æ•°æ®å¤„ç†é…ç½®
    data_processing:
      relative_displacement_mode: true
      quaternion_to_euler: true
      
      # æœºå™¨äººæ§åˆ¶é¢‘ç‡é™åˆ¶ï¼ˆåŒ¹é…ç¡¬ä»¶èƒ½åŠ›ï¼‰
      robot_control_rate: 10.0              # Hz
      position_change_threshold: 0.002      # 2mm
      
      log_frequency: 10            # æ¯Næ¬¡è®°å½•ä¸€æ¬¡æ—¥å¿—
      debug_mode: false
      
      # æ§åˆ¶çŠ¶æ€å®šä¹‰
      control_states:
        waiting_for_calibration: "waiting_for_calibration"
        waiting_for_control: "waiting_for_control"
        ready_to_control: "ready_to_control"
        controlling: "controlling"

    # æ•°æ®å›ä¼ é…ç½®
    data_feedback:
      enabled: true
      feedback_rate: 10.0          # Hz
      topics:
        joint_angles:
          topic_name: "/robot_joint_angles"
          enabled: true
        cartesian_pose:
          topic_name: "/robot_cartesian_pose"
          enabled: true
          frame_id: "robot_base"
      
      error_handling:
        error_joint_angles: [0, 0, 0, 0, 0, 0]
        error_cartesian_pose: [0, 0, 0, 0, 0, 0]
        publish_error_data: false

    # æ•°æ®æå–é…ç½®
    useful_fields:
      right_arm:
        position: {x: true, y: true, z: true}
        rotation: {x: true, y: true, z: true, w: true}

    # åæ ‡è½¬æ¢é…ç½®
    coordinate_transformation:
      transformation_matrix:
        - [-1, 0, 0]               # Xè½´å–å
        - [0, 1, 0]                # Yè½´ä¿æŒ
        - [0, 0, 1]                # Zè½´ä¿æŒ
      transform_position: true
      transform_rotation: true
```

---

## ğŸ”„ æ•°æ®æµç¨‹è¯¦è§£

### å®Œæ•´æ§åˆ¶æµç¨‹

```
é¥æ“ä½œæ¥å£å‘å¸ƒè¯é¢˜
    â†“
pose_callback() æ¥æ”¶ (ROS2çº¿ç¨‹)
    â†“
DataExtractor.extract_pose_data()
    â”œâ”€ æå–position: {x, y, z}
    â””â”€ æå–orientation: {x, y, z, w}
    â†“
DataTransformer.transform_data()
    â”œâ”€ åæ ‡è½¬æ¢: æ ‡å‡† â†’ æœºå™¨äºº
    â”œâ”€ å››å…ƒæ•° â†’ æ¬§æ‹‰è§’
    â””â”€ å•ä½è½¬æ¢: m â†’ mm
    â†“
RobotController.control_robot_motion()
    â”œâ”€ çŠ¶æ€æœºåˆ¤æ–­
    â”œâ”€ ç›¸å¯¹ä½ç§»è®¡ç®—
    â”œâ”€ é™æµæ£€æŸ¥
    â”‚   â”œâ”€ æ—¶é—´é—´éš”æ£€æŸ¥
    â”‚   â””â”€ ä½ç½®å˜åŒ–æ£€æŸ¥
    â””â”€ _send_command_async()
        â””â”€ command_queue.put()  [éé˜»å¡]
    â†“
_command_worker() (å·¥ä½œçº¿ç¨‹)
    â”œâ”€ command_queue.get()  [é˜»å¡ç­‰å¾…]
    â””â”€ mc.write_coords()    [é˜»å¡æ‰§è¡Œ]
    â†“
ElephantRobot æ‰§è¡Œè¿åŠ¨
```

---

## ğŸ› ï¸ ä½¿ç”¨æŒ‡å—

### ç›‘æ§ROS2è¯é¢˜

```bash
# æŸ¥çœ‹è®¢é˜…çš„è¯é¢˜
ros2 topic echo /target_right_arm_pose
ros2 topic echo /target_right_buttons

# æŸ¥çœ‹å‘å¸ƒçš„åé¦ˆè¯é¢˜
ros2 topic echo /robot_joint_angles
ros2 topic echo /robot_cartesian_pose

# æŸ¥çœ‹è¯é¢˜é¢‘ç‡
ros2 topic hz /target_right_arm_pose
ros2 topic hz /robot_cartesian_pose

# æŸ¥çœ‹è¯é¢˜ä¿¡æ¯
ros2 topic info /target_right_arm_pose
```

### æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€

```bash
# æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨
ros2 node list

# æŸ¥çœ‹èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯
ros2 node info /robot_interface_node

# æŸ¥çœ‹å‚æ•°
ros2 param list /robot_interface_node
ros2 param get /robot_interface_node robot_control_rate
```

### è°ƒè¯•æ¨¡å¼

```bash
# ä»¥è°ƒè¯•æ—¥å¿—çº§åˆ«å¯åŠ¨
ros2 run robot_interface robot_interface_node --ros-args --log-level debug

# å¯ç”¨æµ‹è¯•æ¨¡å¼ï¼ˆæ— éœ€å®é™…æœºå™¨äººï¼‰
# åœ¨robot_config.yamlä¸­è®¾ç½®: test_mode: true
```

### æµ‹è¯•å‘½ä»¤

```bash
# å‘å¸ƒæµ‹è¯•å§¿æ€
ros2 topic pub /target_right_arm_pose geometry_msgs/PoseStamped \
  "{header: {frame_id: 'world'}, \
    pose: {position: {x: 0.3, y: 0.2, z: 0.4}, \
           orientation: {x: 0, y: 0, z: 0, w: 1}}}"

# å‘å¸ƒæµ‹è¯•æŒ‰é’®
ros2 topic pub /target_right_buttons std_msgs/Float32MultiArray \
  "{data: [1, 0, 0, 0, 0]}"
```

---

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1: æ— æ³•è¿æ¥æœºå™¨äºº

**ç—‡çŠ¶**ï¼šå¯åŠ¨æ—¶æŠ¥é”™ "Failed to connect to robot"

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥ç½‘ç»œè¿æ¥
ping 192.168.10.150

# 2. æ£€æŸ¥æœºå™¨äººç”µæºå’Œç½‘ç»œé…ç½®

# 3. å°è¯•æµ‹è¯•æ¨¡å¼
# åœ¨robot_config.yamlä¸­è®¾ç½®:
robot_connection:
  test_mode: true

# 4. æ£€æŸ¥pymycobotåº“
python3 -c "from pymycobot.elephantrobot import ElephantRobot"
```

### é—®é¢˜2: æœºå™¨äººè¿åŠ¨å»¶è¿Ÿ

**ç—‡çŠ¶**ï¼šæ‰‹æŸ„ç§»åŠ¨åæœºå™¨äººååº”æ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
# 1. é™ä½æ§åˆ¶é¢‘ç‡ï¼ˆå·²ä¼˜åŒ–ä¸º10Hzï¼‰
data_processing:
  robot_control_rate: 10.0

# 2. å¢åŠ ä½ç½®é˜ˆå€¼ï¼ˆè¿‡æ»¤å°æŠ–åŠ¨ï¼‰
  position_change_threshold: 0.002

# 3. æ£€æŸ¥å¼‚æ­¥é˜Ÿåˆ—æ˜¯å¦å¯ç”¨
# æ—¥å¿—åº”æ˜¾ç¤º: "Async command queue enabled"
```

### é—®é¢˜3: æœºå™¨äººä¸å“åº”æŒ‰é’®

**ç—‡çŠ¶**ï¼šæŒ‰ä¸‹A/BæŒ‰é’®æ— ååº”

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥æŒ‰é’®è¯é¢˜
ros2 topic echo /target_right_buttons

# 2. æ£€æŸ¥æ—¥å¿—è¾“å‡º
# åº”è¯¥çœ‹åˆ° "Button data received" æˆ–çŠ¶æ€å˜åŒ–

# 3. ç¡®è®¤çŠ¶æ€æœºçŠ¶æ€
# æ—¥å¿—ä¼šæ˜¾ç¤ºå½“å‰çŠ¶æ€: "Control state: ..."
```

### é—®é¢˜4: è¯¯æŠ¥è­¦å‘Šä¿¡æ¯

**ç—‡çŠ¶**ï¼šç»ˆç«¯æ˜¾ç¤º "Failed to execute coords command" ä½†æœºå™¨äººæ­£å¸¸å·¥ä½œ

**åŸå› **ï¼šå·²ä¿®å¤ï¼write_coords()è¿”å›å€¼ä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼šä»£ç å·²æ›´æ–°ï¼Œç§»é™¤äº†ä¸å‡†ç¡®çš„è¿”å›å€¼åˆ¤æ–­

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|-----|------|------|
| **æ§åˆ¶å»¶è¿Ÿ** | < 110ms | æ¥æ”¶è¯é¢˜ â†’ æœºå™¨äººè¿åŠ¨ |
| **å¤„ç†æ—¶é—´** | ~2ms | æå–+è½¬æ¢+æ§åˆ¶é€»è¾‘ |
| **å‘½ä»¤å…¥é˜Ÿ** | ~0.1ms | å¼‚æ­¥é˜Ÿåˆ—ï¼ˆéé˜»å¡ï¼‰ |
| **write_coords** | 50-100ms | å·¥ä½œçº¿ç¨‹æ‰§è¡Œï¼ˆä¸å½±å“ä¸»çº¿ç¨‹ï¼‰ |
| **æ§åˆ¶é¢‘ç‡** | â‰¤10Hz | é™æµåå®é™…é¢‘ç‡ |
| **å›ä¼ é¢‘ç‡** | ç¨³å®š10Hz | å®šæ—¶å™¨ä¿è¯ |
| **å†…å­˜å ç”¨** | < 100MB | åŒ…å«ROS2å’ŒSDK |
| **CPUå ç”¨** | < 10% | æ­£å¸¸è¿è¡Œæ—¶ |

---

## ğŸ“ æŠ€æœ¯äº®ç‚¹

### 1. é€šç”¨APIæ¶æ„ â­æ–°å¢
- **è®¾è®¡ç†å¿µ**ï¼šé…ç½®é©±åŠ¨ï¼Œæ§åˆ¶é€»è¾‘ä¸æœºå™¨äººAPIå®Œå…¨è§£è€¦
- **å®ç°æ–¹å¼**ï¼š
  - ä½¿ç”¨Python `getattr`åŠ¨æ€è°ƒç”¨æœºå™¨äººæ–¹æ³•
  - æ‰€æœ‰APIè°ƒç”¨é€šè¿‡`call_robot_api(command_key, *args)`ç»Ÿä¸€æ¥å£
  - é…ç½®æ–‡ä»¶æ˜ å°„ï¼šé€šç”¨å‘½ä»¤å â†’ å…·ä½“æœºå™¨äººAPIæ–¹æ³•å
- **ä¼˜åŠ¿**ï¼š
  - âœ… æ›´æ¢æœºå™¨äººä»…éœ€ä¿®æ”¹é…ç½®æ–‡ä»¶å’Œ1å¤„å¯¼å…¥ä»£ç 
  - âœ… æ ¸å¿ƒæ§åˆ¶é€»è¾‘100%å¤ç”¨
  - âœ… æ”¯æŒä»»æ„å“ç‰Œæœºå™¨äººï¼ˆURã€Frankaã€ABBç­‰ï¼‰
  - âœ… æ–°å¢æœºå™¨äººç±»å‹åªéœ€æ‰©å±•é…ç½®
- **ç¤ºä¾‹**ï¼š
  ```python
  # ä»£ç å±‚ï¼šä½¿ç”¨é€šç”¨å‘½ä»¤å
  self.call_robot_api('position_command', target, speed)
  
  # é…ç½®å±‚ï¼šæ˜ å°„åˆ°å…·ä½“API
  # ElephantRobot: position_command: "write_coords"
  # URæœºå™¨äºº:      position_command: "movel"
  # Franka:       position_command: "move_cartesian"
  ```

### 2. å¼‚æ­¥å‘½ä»¤é˜Ÿåˆ—
- **é—®é¢˜**ï¼šwrite_coords()é˜»å¡å¯¼è‡´å»¶è¿Ÿç´¯ç§¯
- **æ–¹æ¡ˆ**ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œå·¥ä½œçº¿ç¨‹ç‹¬ç«‹æ‰§è¡Œ
- **æ•ˆæœ**ï¼šä¸»çº¿ç¨‹è€—æ—¶ä»100msé™è‡³2ms

### 3. ä¸‰å±‚é™é‡‡æ ·
- **ç¬¬1å±‚**ï¼šé¥æ“ä½œæ¥å£ç¨³å®š10Hzè¾“å‡º
- **ç¬¬2å±‚**ï¼šæ§åˆ¶å™¨æ—¶é—´+ç©ºé—´åŒé‡é™æµ
- **ç¬¬3å±‚**ï¼šå¼‚æ­¥é˜Ÿåˆ—è‡ªåŠ¨ä¸¢å¼ƒè¿‡æ—¶å‘½ä»¤

### 4. çŠ¶æ€æœºæ§åˆ¶
- å®‰å…¨çš„å¤šé˜¶æ®µæ§åˆ¶æµç¨‹
- æ­»äººå¼€å…³ä¿æŠ¤
- æ ‡å®šæœºåˆ¶ç¡®ä¿ç²¾åº¦

### 5. å®æ—¶æ•°æ®å›ä¼ 
- ç‹¬ç«‹å®šæ—¶å™¨ï¼Œä¸å½±å“æ§åˆ¶å¾ªç¯
- 10Hzç¨³å®šåé¦ˆ
- é”™è¯¯æ•°æ®è¿‡æ»¤

---

## ğŸ“„ ä¾èµ–é¡¹

### ç³»ç»Ÿä¾èµ–
- Ubuntu 22.04 (æ¨è)
- ROS2 Humble
- Python 3.10

### PythonåŒ…
- `rclpy` - ROS2 Pythonå®¢æˆ·ç«¯
- `numpy` - æ•°å€¼è®¡ç®—
- `pyyaml` - YAMLé…ç½®
- `pymycobot` - ElephantRobot SDK
- `geometry_msgs` - ROS2å‡ ä½•æ¶ˆæ¯
- `std_msgs` - ROS2æ ‡å‡†æ¶ˆæ¯

### ç¡¬ä»¶
- ElephantRobot æœºæ¢°è‡‚
- ç½‘ç»œè¿æ¥ï¼ˆTCP/IPï¼Œ5001ç«¯å£ï¼‰

---

## ğŸ”’ å®‰å…¨è€ƒè™‘

- âœ… **æ­»äººå¼€å…³**ï¼šSecondæŒ‰é’®å¿…é¡»æŒç»­æŒ‰ä¸‹
- âœ… **çŠ¶æ€æœºä¿æŠ¤**ï¼šå¿…é¡»æŒ‰é¡ºåºæ ‡å®šå’Œå¯åŠ¨
- âœ… **é™æµä¿æŠ¤**ï¼šé˜²æ­¢è¿‡å¿«å‘½ä»¤æŸåæœºå™¨äºº
- âœ… **å¼‚å¸¸å¤„ç†**ï¼šæ‰€æœ‰å…³é”®æ“ä½œæœ‰try-except
- âš ï¸ **å·¥ä½œç©ºé—´**ï¼šç¡®ä¿æœºå™¨äººå‘¨å›´æ— éšœç¢ç‰©

---

## ğŸ“ å¼€å‘æŒ‡å—

### ğŸ”§ é€šç”¨APIæ¶æ„è¯´æ˜

æœ¬ç³»ç»Ÿé‡‡ç”¨**é…ç½®é©±åŠ¨çš„é€šç”¨APIæ¶æ„**ï¼Œå®ç°äº†æ§åˆ¶é€»è¾‘ä¸å…·ä½“æœºå™¨äººAPIçš„å®Œå…¨è§£è€¦ã€‚

**æ ¸å¿ƒè®¾è®¡ç†å¿µ**ï¼š
```python
# ä»£ç ä¸­ä½¿ç”¨é€šç”¨å‘½ä»¤é”®å
self.call_robot_api('position_command', target_position, speed)

# é…ç½®æ–‡ä»¶æ˜ å°„åˆ°å…·ä½“API
commands:
  position_command: "write_coords"  # ElephantRobotçš„APIæ–¹æ³•å
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ›´æ¢æœºå™¨äººåªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶
- âœ… æ ¸å¿ƒæ§åˆ¶é€»è¾‘æ— éœ€æ”¹åŠ¨
- âœ… æ”¯æŒä»»æ„å“ç‰Œæœºå™¨äºº
- âœ… æ˜“äºç»´æŠ¤å’Œæ‰©å±•

---

### ğŸš€ å¦‚ä½•æ›´æ¢æœºå™¨äººï¼ˆå®Œæ•´æŒ‡å—ï¼‰

#### ç¤ºä¾‹ï¼šä»ElephantRobotåˆ‡æ¢åˆ°Universal Robots (UR)

##### æ­¥éª¤1: å®‰è£…æ–°æœºå™¨äººçš„Python SDK

```bash
# URæœºå™¨äººç¤ºä¾‹
pip install urx

# æˆ–å…¶ä»–æœºå™¨äººçš„SDK
# pip install franka-python  # Franka Emika
# pip install interbotix-xs-modules  # Interbotix
```

##### æ­¥éª¤2: ä¿®æ”¹æœºå™¨äººè¿æ¥ä»£ç ï¼ˆä»…1å¤„ï¼‰

ç¼–è¾‘ `src/robot_interface/elephant_robot/robot_interface_node.py`ï¼š

```python
# æ‰¾åˆ°ç¬¬26è¡Œé™„è¿‘çš„å¯¼å…¥è¯­å¥
# åŸæ¥ï¼š
from pymycobot.elephantrobot import ElephantRobot

# æ”¹ä¸ºï¼š
from urx import Robot as URRobot  # URæœºå™¨äºº
# æˆ–
# from franka import Robot as FrankaRobot  # Franka
# æˆ–
# from interbotix_xs_modules.arm import InterbotixManipulatorXS  # Interbotix

# æ‰¾åˆ°ç¬¬194è¡Œé™„è¿‘çš„æœºå™¨äººå®ä¾‹åŒ–
# åŸæ¥ï¼š
self.mc = ElephantRobot(ip, port)

# æ”¹ä¸ºï¼š
self.mc = URRobot(ip)  # URæœºå™¨äººï¼ˆæ³¨æ„URä¸éœ€è¦portå‚æ•°ï¼‰
# æˆ–
# self.mc = FrankaRobot(ip)  # Franka
# æˆ–
# self.mc = InterbotixManipulatorXS("px150", "arm", "gripper")  # Interbotix

# æ‰¾åˆ°ç¬¬197-200è¡Œçš„start_clientè°ƒç”¨ï¼ˆå¦‚æœæ–°æœºå™¨äººä¸éœ€è¦ï¼Œæ³¨é‡Šæ‰ï¼‰
# res = self.mc.start_client()
# if not res:
#     self.get_logger().error(f"Failed to start robot client: {res}")
#     sys.exit(1)
```

##### æ­¥éª¤3: ä¿®æ”¹é…ç½®æ–‡ä»¶çš„å‘½ä»¤æ˜ å°„

ç¼–è¾‘ `config/robot_config.yaml`ï¼Œå°†å‘½ä»¤æ˜ å°„åˆ°æ–°æœºå™¨äººçš„APIï¼š

```yaml
robot_control:
  connection:
    ip: "192.168.1.100"  # URæœºå™¨äººIP
    port: 30002          # URé€šå¸¸ä½¿ç”¨30002ç«¯å£
  
  commands:
    # URæœºå™¨äººçš„APIæ–¹æ³•åï¼ˆå‚è€ƒUR SDKæ–‡æ¡£ï¼‰
    power_on_command: "set_tcp"              # UR: è®¾ç½®å·¥å…·ä¸­å¿ƒç‚¹
    start_robot_command: "set_payload"       # UR: è®¾ç½®è´Ÿè½½
    get_state_command: "is_program_running"  # UR: æ£€æŸ¥ç¨‹åºè¿è¡ŒçŠ¶æ€
    speed_command: "set_tcp_speed"           # UR: è®¾ç½®é€Ÿåº¦
    
    # è¿åŠ¨æ§åˆ¶
    position_command: "movel"                # UR: ç›´çº¿è¿åŠ¨åˆ°ç¬›å¡å°”åæ ‡
    angle_command: "movej"                   # UR: å…³èŠ‚è¿åŠ¨
    wait_command: "wait_move"                # UR: ç­‰å¾…è¿åŠ¨å®Œæˆ
    
    # å¤¹çˆªæ§åˆ¶ï¼ˆå¦‚æœä½¿ç”¨URåŸç”ŸIOï¼‰
    gripper_mode_command: "set_digital_out"  # UR: è®¾ç½®æ•°å­—è¾“å‡º
    gripper_state_command: "set_digital_out" # UR: è®¾ç½®æ•°å­—è¾“å‡º
    
    # æ•°æ®è·å–
    get_angles_command: "getj"               # UR: è·å–å…³èŠ‚è§’åº¦
    get_coords_command: "getl"               # UR: è·å–ç¬›å¡å°”åæ ‡
```

##### æ­¥éª¤4: è°ƒæ•´å‚æ•°æ ¼å¼ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰

æŸäº›æœºå™¨äººçš„APIå‚æ•°æ ¼å¼å¯èƒ½ä¸åŒï¼Œéœ€è¦åœ¨ä»£ç ä¸­æ·»åŠ é€‚é…å±‚ï¼š

```python
# å¦‚æœURçš„APIå‚æ•°æ ¼å¼ä¸åŒï¼Œåœ¨robot_interface_node.pyä¸­æ·»åŠ è½¬æ¢
def call_robot_api(self, command_key, *args):
    """é€šç”¨æœºå™¨äººAPIè°ƒç”¨æ–¹æ³•"""
    # ... åŸæœ‰ä»£ç  ...
    
    # å‚æ•°æ ¼å¼è½¬æ¢ï¼ˆç¤ºä¾‹ï¼‰
    if command_key == 'position_command' and 'UR' in robot_type:
        # URçš„moveléœ€è¦[x,y,z,rx,ry,rz]å’ŒåŠ é€Ÿåº¦ã€é€Ÿåº¦å‚æ•°
        position, speed = args
        # è½¬æ¢æ ¼å¼
        args = (position, 0.5, speed/100.0)  # (pose, accel, vel)
    
    result = api_method(*args)
    # ...
```

##### æ­¥éª¤5: æµ‹è¯•æ–°é…ç½®

```bash
# 1. é‡æ–°æ„å»º
cd /home/airspeedbox/code/vr_robot_control_ws
colcon build --packages-select robot_interface

# 2. å¯åŠ¨æµ‹è¯•æ¨¡å¼éªŒè¯
# å…ˆåœ¨robot_config.yamlä¸­è®¾ç½®: test_mode: true

# 3. è¿æ¥å®é™…æœºå™¨äººæµ‹è¯•
# è®¾ç½®: test_mode: false
./src/robot_interface/launch.sh
```

**å®Œæˆï¼** ç°åœ¨ç³»ç»Ÿå·²é€‚é…æ–°æœºå™¨äººã€‚ğŸ‰

---

### ğŸ“‹ æ”¯æŒçš„æœºå™¨äººç¤ºä¾‹

| æœºå™¨äººå“ç‰Œ | SDKåŒ…å | position_command | angle_command | get_angles_command |
|-----------|---------|-----------------|--------------|-------------------|
| **ElephantRobot** | `pymycobot` | `write_coords` | `write_angles` | `get_angles` |
| **Universal Robots** | `urx` | `movel` | `movej` | `getj` |
| **Franka Emika** | `franka-python` | `move_cartesian` | `move_joint` | `get_joint_positions` |
| **ABB** | `abb-robot-driver` | `set_cartesian` | `set_joints` | `get_joints` |
| **KUKA** | `pykuka` | `move_lin` | `move_ptp` | `get_axis_position` |
| **Interbotix** | `interbotix_xs_modules` | `set_ee_pose_components` | `set_joint_positions` | `get_joint_positions` |

---

### ğŸ” é€šç”¨APIå‘½ä»¤æ¸…å•

å¯åŠ¨ç³»ç»Ÿæ—¶ä¼šæ˜¾ç¤ºå½“å‰åŠ è½½çš„å‘½ä»¤æ˜ å°„ï¼š

```
============================================================
é€šç”¨æœºå™¨äººAPIå‘½ä»¤æ˜ å°„å·²åŠ è½½:
  - ç”µæºå¼€å¯: _power_on
  - å¯åŠ¨æœºå™¨äºº: start_robot
  - ä½ç½®æ§åˆ¶: write_coords
  - è§’åº¦æ§åˆ¶: write_angles
  - å¤¹çˆªæ¨¡å¼: set_gripper_mode
  - å¤¹çˆªçŠ¶æ€: set_gripper_state
  - è·å–è§’åº¦: get_angles
  - è·å–åæ ‡: get_coords
æ›´æ¢æœºå™¨äººæ—¶åªéœ€ä¿®æ”¹robot_config.yamlä¸­çš„commandsé…ç½®
============================================================
```

è¿™å¯ä»¥å¸®åŠ©ä½ ç¡®è®¤å‘½ä»¤æ˜ å°„æ˜¯å¦æ­£ç¡®åŠ è½½ã€‚

### è‡ªå®šä¹‰æ§åˆ¶é€»è¾‘

ä¿®æ”¹`RobotController.control_robot_motion()`æ–¹æ³•ï¼š
```python
def control_robot_motion(self, transformed_data, mc, ...):
    # è‡ªå®šä¹‰ä½ç§»è®¡ç®—
    custom_displacement = calculate_custom_displacement()
    
    # è‡ªå®šä¹‰é™æµæ¡ä»¶
    if custom_condition():
        self._send_command_async('coords', (target, speed))
```

### æ·»åŠ æ–°çš„æ§åˆ¶çŠ¶æ€

åœ¨`robot_config.yaml`ä¸­æ·»åŠ ï¼š
```yaml
control_states:
  custom_state: "custom_state"
```

åœ¨ä»£ç ä¸­å®ç°çŠ¶æ€è½¬æ¢é€»è¾‘ã€‚

---

## ğŸ“ æ”¯æŒä¸åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
- æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼ˆåŒ…å«è¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼‰
- æ£€æŸ¥é…ç½®æ–‡ä»¶å‚æ•°
- ç¡®è®¤æœºå™¨äººç½‘ç»œè¿æ¥
- éªŒè¯ROS2è¯é¢˜æ˜¯å¦æ­£å¸¸

---

## ğŸŒŸ æ€»ç»“

æœ¬æœºå™¨äººæ¥å£é‡‡ç”¨**ç”Ÿäº§çº§åˆ«çš„é€šç”¨åŒ–æ¶æ„**ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### âœ… æ ¸å¿ƒä¼˜åŠ¿
1. **é€šç”¨APIæ¶æ„** - é…ç½®é©±åŠ¨ï¼Œè½»æ¾æ”¯æŒä¸åŒå“ç‰Œæœºå™¨äºº
2. **é›¶å»¶è¿Ÿæ§åˆ¶** - å¼‚æ­¥å‘½ä»¤é˜Ÿåˆ—æ¶ˆé™¤é˜»å¡
3. **ç²¾å‡†é™é‡‡æ ·** - ä¸‰å±‚ç­–ç•¥åŒ¹é…æœºå™¨äººç¡¬ä»¶èƒ½åŠ›
4. **å®‰å…¨å¯é ** - çŠ¶æ€æœºä¿æŠ¤ + æ­»äººå¼€å…³
5. **å®æ—¶åé¦ˆ** - 10Hzç¨³å®šçš„çŠ¶æ€æ•°æ®å›ä¼ 

### ğŸ¯ é€‚ç”¨åœºæ™¯
- âœ… VRé¥æ“ä½œæ§åˆ¶
- âœ… å¤šå“ç‰Œæœºå™¨äººå¹³å°
- âœ… å®æ—¶æ§åˆ¶ç³»ç»Ÿ
- âœ… ç§‘ç ”ä¸æ•™å­¦

### ğŸš€ æœªæ¥æ‰©å±•
- æ”¯æŒæ›´å¤šæœºå™¨äººå“ç‰Œï¼ˆURã€Frankaã€ABBã€KUKAç­‰ï¼‰
- æ·»åŠ åŠ›åé¦ˆæ”¯æŒ
- å¤šæœºå™¨äººååŒæ§åˆ¶
- è‡ªå®šä¹‰æ§åˆ¶ç­–ç•¥

---

**æ³¨æ„**ï¼šæœ¬ç³»ç»Ÿå·²å®ç°é€šç”¨åŒ–æ¶æ„æ”¹é€ ï¼Œå¯è½»æ¾é€‚é…ä»»æ„å“ç‰Œæœºå™¨äººã€‚æ ¸å¿ƒæ§åˆ¶é€»è¾‘ç»è¿‡å»¶è¿Ÿä¼˜åŒ–å’Œç¨³å®šæ€§æµ‹è¯•ï¼Œå¼‚æ­¥å‘½ä»¤é˜Ÿåˆ—å’Œä¸‰å±‚é™é‡‡æ ·ç­–ç•¥ç¡®ä¿äº†æµç•…çš„é¥æ“ä½œä½“éªŒã€‚æ›´æ¢æœºå™¨äººæ—¶åªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯ï¼ğŸš€
